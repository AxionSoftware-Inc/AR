<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebXR 6DoF Navigation</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
      #overlay {
        position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
        z-index: 10; background: rgba(0,0,0,0.7); color: white;
        padding: 15px; border-radius: 10px; font-family: sans-serif; text-align: center;
        width: 80%; pointer-events: none; display: none;
      }
    </style>
  </head>
  <body>

    <div id="overlay">Siz 103-xonaga yetib keldingiz!</div>

    <a-scene webxr="requiredFeatures: local-floor, hit-test">
      
      <a-assets>
        <a-mixin id="arrow-mesh" 
                 geometry="primitive: cone; radiusBottom: 0.1; height: 0.3" 
                 material="color: #00FF00; emissive: #00FF00" 
                 rotation="90 0 0"></a-mixin>
      </a-assets>

      <a-camera id="camera" look-controls wasd-controls position="0 1.6 0">
        <a-entity cursor="fuse: false; rayOrigin: mouse"></a-entity>
      </a-camera>

      <a-entity id="navigation-path">
        </a-entity>

      <a-entity id="destination" position="10 0.1 0">
        <a-ring color="red" radius-inner="0.4" radius-outer="0.5" rotation="-90 0 0"></a-ring>
        <a-text value="103-Xona" align="center" position="0 1 0" scale="2 2 2"></a-text>
      </a-entity>

    </a-scene>

    <script>
      const pathContainer = document.querySelector('#navigation-path');
      const camera = document.querySelector('#camera');
      const overlay = document.querySelector('#overlay');
      const destPos = { x: 10, z: 0 }; // 10 metr o'ngga (X o'qi bo'ylab)

      // 1. Yo'l bo'ylab strelkalarni (array) joylashtirish
      function buildPath() {
        for (let i = 1; i <= 10; i++) {
          let arrow = document.createElement('a-entity');
          arrow.setAttribute('mixin', 'arrow-mesh');
          // Strelkalarni har 1 metrda X o'qi bo'ylab qo'yamiz
          arrow.setAttribute('position', `${i} 0.1 0`); 
          // Strelka o'ngga qarashi uchun (X o'qi bo'ylab)
          arrow.setAttribute('rotation', '0 0 -90'); 
          pathContainer.appendChild(arrow);
        }
      }

      // 2. 6DoF masofani o'lchash mantig'i
      AFRAME.registerComponent('nav-tracker', {
        tick: function () {
          // Kameraning hozirgi pozitsiyasi
          let pos = camera.object3D.position;

          // Evklid masofasi: d = sqrt((x2-x1)^2 + (z2-z1)^2)
          let distance = Math.sqrt(
            Math.pow(destPos.x - pos.x, 2) + 
            Math.pow(destPos.z - pos.z, 2)
          );

          // Agar manzilga 1.5 metr qolsa
          if (distance < 1.5) {
            overlay.style.display = 'block';
          } else {
            overlay.style.display = 'none';
          }
        }
      });

      // Komponentni sahnaga qo'shish
      document.querySelector('a-scene').setAttribute('nav-tracker', '');

      // Yo'lni chizish
      buildPath();
    </script>
  </body>
</html>